<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trò Chơi Tìm Chữ Cái (Offline)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap');
        
        body {
            font-family: 'Quicksand', sans-serif, Arial, sans-serif;
            background-color: #f0f9ff;
            margin: 0;
            padding: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 896px; /* tương đương max-w-4xl */
            text-align: center;
        }

        h1 {
            font-size: 2.25rem; /* tương đương text-4xl */
            font-weight: 700;
            color: #2563eb; /* tương đương text-blue-600 */
            margin-bottom: 0.5rem;
        }

        #game-controls {
            margin-bottom: 1.5rem;
            min-height: 4rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #prompt-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        #game-prompt {
            color: #374151; /* text-gray-700 */
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600;
        }

        button {
            padding: 0.75rem 2rem;
            color: white;
            font-weight: 700;
            border: none;
            border-radius: 9999px; /* rounded-full */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }

        /* **CẬP NHẬT**: Kiểu cho các nút ở menu */
        #menu-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
        }
        .menu-btn {
            font-size: 1.125rem;
            padding: 1rem 2.5rem;
        }

        #start-game-btn { background-color: #f97316; } /* bg-orange-500 */
        #start-game-btn:hover { background-color: #ea580c; } /* hover:bg-orange-600 */

        #review-mode-btn { background-color: #16a34a; } /* bg-green-600 */
        #review-mode-btn:hover { background-color: #15803d; } /* hover:bg-green-700 */

        #play-again-btn, #back-to-menu-win-btn { background-color: #3b82f6; margin-top: 1rem; }
        #play-again-btn:hover, #back-to-menu-win-btn:hover { background-color: #2563eb; }

        #repeat-question-btn {
            background-color: #9ca3af; /* bg-gray-400 */
            padding: 0.5rem;
            margin: 0;
            width: 44px;
            height: 44px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #repeat-question-btn:hover { background-color: #6b7280; /* bg-gray-500 */ }
        
        #back-btn {
            background-color: #6b7280;
            margin-top: 1.5rem;
        }
        #back-btn:hover { background-color: #4b5563; }

        #alphabet-grid {
            display: grid;
            gap: 1rem;
            background-color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            grid-template-columns: repeat(4, 1fr);
        }

        @media (min-width: 640px) { #alphabet-grid { grid-template-columns: repeat(5, 1fr); } }
        @media (min-width: 768px) { #alphabet-grid { grid-template-columns: repeat(7, 1fr); } }
        @media (min-width: 1024px) { #alphabet-grid { grid-template-columns: repeat(8, 1fr); } }

        .letter-box {
            color: white;
            font-size: 2.25rem;
            font-weight: 700;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1 / 1;
            transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out, background-color 0.2s;
        }
        .letter-box:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .bg-red { background-color: #ef4444; } .bg-blue { background-color: #3b82f6; } .bg-green { background-color: #22c55e; } .bg-yellow { background-color: #eab308; } .bg-purple { background-color: #8b5cf6; } .bg-pink { background-color: #ec4899; } .bg-indigo { background-color: #6366f1; } .bg-teal { background-color: #14b8a6; } .bg-orange { background-color: #f97316; }

        .hidden { display: none !important; }

        #win-screen p { font-size: 1.875rem; font-weight: 700; color: #16a34a; }
        .footer-text { font-size: 0.75rem; color: #9ca3af; margin-top: 2rem; }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .shake { animation: shake 0.3s ease-in-out; }

        @keyframes celebrate { 0% { transform: scale(1); } 50% { transform: scale(1.1) rotate(5deg); } 100% { transform: scale(1); } }
        .celebrate { animation: celebrate 0.5s ease-in-out; background-color: #15803d !important; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Trò Chơi Tìm Chữ Cái</h1>
        <div id="game-controls">
            <div id="menu-container">
                <button id="start-game-btn" class="menu-btn">Chơi Theo Thử Thách</button>
                <button id="review-mode-btn" class="menu-btn">Tự Do Ôn Tập</button>
            </div>
            <div id="prompt-container" class="hidden">
                <p id="game-prompt"></p>
                <button id="repeat-question-btn" title="Đọc lại câu hỏi">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                </button>
            </div>
        </div>
        <div id="alphabet-grid" class="hidden"></div>
        <div id="win-screen" class="hidden">
            <p>Chúc mừng con đã hoàn thành!</p>
            <button id="play-again-btn">Chơi lại</button>
            <button id="back-to-menu-win-btn">Về Menu Chính</button>
        </div>
        <button id="back-btn" class="hidden">Quay Lại Menu</button>
        <p class="footer-text">Đọc bởi Gemini AI</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const alphabet = ['A', 'Ă', 'Â', 'B', 'C', 'D', 'Đ', 'E', 'Ê', 'G', 'H', 'I', 'K', 'L', 'M', 'N', 'O', 'Ô', 'Ơ', 'P', 'Q', 'R', 'S', 'T', 'U', 'Ư', 'V', 'X', 'Y'];
            const colors = ['bg-red', 'bg-blue', 'bg-green', 'bg-yellow', 'bg-purple', 'bg-pink', 'bg-indigo', 'bg-teal', 'bg-orange'];
            const phoneticMap = { 'A': 'a', 'Ă': 'ă', 'Â': 'â', 'B': 'bờ', 'C': 'cờ', 'D': 'dờ', 'Đ': 'đờ', 'E': 'e', 'Ê': 'ê', 'G': 'gờ', 'H': 'hờ', 'I': 'i ngắn', 'K': 'ca', 'L': 'lờ', 'M': 'mờ', 'N': 'nờ', 'O': 'o', 'Ô': 'ô', 'Ơ': 'ơ', 'P': 'pờ', 'Q': 'quờ', 'R': 'rờ', 'S': 'sờ', 'T': 'tờ', 'U': 'u', 'Ư': 'ư', 'V': 'vờ', 'X': 'xờ', 'Y': 'i dài' };
            const exampleWordMap = { 'A': 'Cái Ca', 'Ă': 'Cái Khăn', 'Â': 'Cái Cân', 'B': 'Bé Bò', 'C': 'Con Cá', 'D': 'Con Dê', 'Đ': 'Đà Điểu', 'E': 'Em Bé', 'Ê': 'Con Ếch', 'G': 'Con Gà', 'H': 'Hoa Hồng', 'I': 'Viên Bi', 'K': 'Cái Kéo', 'L': 'Lọ Lem', 'M': 'Con Mèo', 'N': 'Cái Nơ', 'O': 'Con Bò', 'Ô': 'Cái Ô', 'Ơ': 'Lá Cờ', 'P': 'Đèn Pin', 'Q': 'Quyển Vở', 'R': 'Con Rùa', 'S': 'Con Sóc', 'T': 'Con Tôm', 'U': 'Củ Su', 'Ư': 'Hộp Thư', 'V': 'Con Voi', 'X': 'Xe Đạp', 'Y': 'Y Tá' };

            const grid = document.getElementById('alphabet-grid');
            const gamePrompt = document.getElementById('game-prompt');
            const startGameBtn = document.getElementById('start-game-btn');
            const winScreen = document.getElementById('win-screen');
            const playAgainBtn = document.getElementById('play-again-btn');
            const promptContainer = document.getElementById('prompt-container');
            const repeatQuestionBtn = document.getElementById('repeat-question-btn');
            const menuContainer = document.getElementById('menu-container');
            const reviewModeBtn = document.getElementById('review-mode-btn');
            const backBtn = document.getElementById('back-btn');
            const backToMenuWinBtn = document.getElementById('back-to-menu-win-btn');

            let currentMode = 'menu'; // 'menu', 'game', 'review'
            let vietnameseVoice = null;
            let shuffledAlphabet = [];
            let currentLetterIndex = 0;
            let gameActive = false;
            let currentQuestionText = '';

            function loadAndSetVoice() {
                const voices = window.speechSynthesis.getVoices();
                if (!voices.length) return;
                const vietnameseVoices = voices.filter(voice => voice.lang === 'vi-VN');
                if (!vietnameseVoices.length) {
                    gamePrompt.textContent = "Lỗi: Không tìm thấy giọng đọc Tiếng Việt trên máy tính.";
                    startGameBtn.disabled = true; reviewModeBtn.disabled = true;
                    return;
                };
                let femaleVoice = vietnameseVoices.find(voice => /nữ|female/i.test(voice.name));
                vietnameseVoice = femaleVoice || vietnameseVoices[0];
            }
            loadAndSetVoice();
            if (window.speechSynthesis.onvoiceschanged !== undefined) {
                window.speechSynthesis.onvoiceschanged = loadAndSetVoice;
            }

            function speak(text, rate = 0.9, pitch = 1.1, onEndCallback = null) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUttersance(text);
                    utterance.lang = 'vi-VN';
                    utterance.rate = rate;
                    utterance.pitch = pitch;
                    if (vietnameseVoice) utterance.voice = vietnameseVoice;
                    if (onEndCallback) {
                        utterance.onend = onEndCallback;
                    }
                    window.speechSynthesis.speak(utterance);
                }
            }
            
            alphabet.forEach(letter => {
                const letterDiv = document.createElement('div');
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                letterDiv.className = `letter-box ${randomColor}`;
                letterDiv.textContent = letter;
                letterDiv.setAttribute('data-letter', letter);
                grid.appendChild(letterDiv);
            });
            
            function showMenu() {
                currentMode = 'menu';
                window.speechSynthesis.cancel();
                menuContainer.classList.remove('hidden');
                grid.classList.add('hidden');
                promptContainer.classList.add('hidden');
                winScreen.classList.add('hidden');
                backBtn.classList.add('hidden');
            }

            function setupReviewMode() {
                currentMode = 'review';
                menuContainer.classList.add('hidden');
                grid.classList.remove('hidden');
                backBtn.classList.remove('hidden');
            }
            
            function askForNextLetter() {
                if (currentLetterIndex >= shuffledAlphabet.length) {
                    endGame();
                    return;
                }
                const letterToFind = shuffledAlphabet[currentLetterIndex];
                const phonetic = phoneticMap[letterToFind];
                currentQuestionText = `Con hãy tìm chữ '${phonetic}'`;
                gamePrompt.textContent = currentQuestionText;
                speak(currentQuestionText);
            }

            function startGame() {
                currentMode = 'game';
                gameActive = true;
                currentLetterIndex = 0;
                shuffledAlphabet = [...alphabet].sort(() => 0.5 - Math.random());
                menuContainer.classList.add('hidden');
                promptContainer.classList.remove('hidden');
                winScreen.classList.add('hidden');
                grid.classList.remove('hidden');
                backBtn.classList.remove('hidden');
                askForNextLetter();
            }

            function endGame() {
                gameActive = false;
                grid.classList.add('hidden');
                winScreen.classList.remove('hidden');
                promptContainer.classList.add('hidden');
                backBtn.classList.add('hidden');
                speak("Con giỏi quá! Chúc mừng con đã hoàn thành trò chơi!");
            }

            grid.addEventListener('click', (event) => {
                const clickedBox = event.target.closest('.letter-box');
                if (!clickedBox) return;

                if (currentMode === 'review') {
                    const clickedLetter = clickedBox.getAttribute('data-letter');
                    const phonetic = phoneticMap[clickedLetter];
                    const example = exampleWordMap[clickedLetter];
                    const sentence = `${phonetic}, có trong từ ${example}`;
                    speak(sentence);
                    clickedBox.classList.add('celebrate');
                    setTimeout(() => clickedBox.classList.remove('celebrate'), 500);
                } 
                else if (currentMode === 'game') {
                    if (!gameActive) return;
                    const clickedLetter = clickedBox.getAttribute('data-letter');
                    const correctLetter = shuffledAlphabet[currentLetterIndex];

                    if (clickedLetter === correctLetter) {
                        gameActive = false;
                        clickedBox.classList.add('celebrate');
                        speak("Đúng rồi!", 0.9, 1.1, () => {
                            const phonetic = phoneticMap[correctLetter];
                            const example = exampleWordMap[correctLetter];
                            const exampleSentence = `${phonetic}, có trong từ ${example}`;
                            speak(exampleSentence, 0.9, 1.1, () => {
                                clickedBox.classList.remove('celebrate');
                                currentLetterIndex++;
                                askForNextLetter();
                                gameActive = true;
                            });
                        });
                    } else {
                        clickedBox.classList.add('shake');
                        speak("Sai rồi, thử lại nhé!");
                        setTimeout(() => clickedBox.classList.remove('shake'), 500);
                    }
                }
            });
            
            repeatQuestionBtn.addEventListener('click', () => {
                if (gameActive && currentQuestionText) speak(currentQuestionText);
            });
            
            startGameBtn.addEventListener('click', startGame);
            reviewModeBtn.addEventListener('click', setupReviewMode);
            backBtn.addEventListener('click', showMenu);
            playAgainBtn.addEventListener('click', startGame);
            backToMenuWinBtn.addEventListener('click', showMenu);
        });
    </script>
</body>
</html>
