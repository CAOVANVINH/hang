<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ Ch∆°i H·ªçc T·∫≠p Vui</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
        }
        .choice-btn {
            transition: all 0.2s ease-in-out;
        }
        .choice-btn.selected {
            transform: scale(1.05);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .answer-option {
            transition: all 0.2s ease-in-out;
        }
        .answer-option:hover:not(:disabled) {
            background-color: #3b82f6;
            color: white;
        }
        .answer-option.correct {
            background-color: #22c55e !important;
            color: white;
            border-color: #16a34a;
        }
        .answer-option.incorrect {
            background-color: #ef4444 !important;
            color: white;
            border-color: #dc2626;
        }
    </style>
</head>
<body class="bg-blue-50 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-2xl p-4 md:p-8">

        <!-- M√†n h√¨nh l·ª±a ch·ªçn -->
        <div id="selection-screen">
            <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-2">Tr√≤ Ch∆°i H·ªçc T·∫≠p</h1>
            <p class="text-center text-gray-500 mb-8">C√πng b√© v·ª´a h·ªçc v·ª´a ch∆°i!</p>

            <!-- Ch·ªçn M√¥n h·ªçc -->
            <div class="mb-6">
                <h2 class="text-xl font-semibold mb-3 text-gray-700">1. Ch·ªçn M√¥n H·ªçc</h2>
                <div class="grid grid-cols-2 gap-4">
                    <button data-subject="toan" class="choice-btn bg-sky-500 text-white font-bold py-4 rounded-lg shadow-md hover:bg-sky-600">
                        üî¢ To√°n H·ªçc
                    </button>
                    <button data-subject="tiengviet" class="choice-btn bg-emerald-500 text-white font-bold py-4 rounded-lg shadow-md hover:bg-emerald-600">
                        ‚úçÔ∏è Ti·∫øng Vi·ªát
                    </button>
                </div>
            </div>

            <!-- Ch·ªçn L·ªõp -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-3 text-gray-700">2. Ch·ªçn L·ªõp</h2>
                <div class="grid grid-cols-2 gap-4">
                    <button data-grade="lop1" class="choice-btn bg-amber-500 text-white font-bold py-4 rounded-lg shadow-md hover:bg-amber-600">
                        L·ªõp 1
                    </button>
                    <button data-grade="lop2" class="choice-btn bg-rose-500 text-white font-bold py-4 rounded-lg shadow-md hover:bg-rose-600">
                        L·ªõp 2
                    </button>
                </div>
            </div>

            <!-- N√∫t B·∫Øt ƒë·∫ßu -->
            <button id="start-btn" class="w-full bg-gray-400 text-white font-bold py-4 rounded-lg text-xl cursor-not-allowed" disabled>
                B·∫Øt ƒë·∫ßu!
            </button>
        </div>

        <!-- M√†n h√¨nh tr√≤ ch∆°i -->
        <div id="game-screen" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <div id="progress-text" class="font-semibold text-gray-600">C√¢u 1/12</div>
                <div id="score-text" class="font-bold text-lg text-green-600">ƒêi·ªÉm: 0</div>
            </div>
            <div id="question-container" class="bg-gray-100 p-6 rounded-lg text-center mb-6 min-h-[100px] flex items-center justify-center">
                <p class="text-xl md:text-2xl font-semibold text-gray-800"></p>
            </div>
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- C√°c l·ª±a ch·ªçn tr·∫£ l·ªùi s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
            </div>
            <div id="feedback-container" class="text-center mt-4 font-bold text-2xl h-8"></div>
            <button id="next-btn" class="hidden w-full mt-4 bg-blue-500 text-white font-bold py-3 rounded-lg hover:bg-blue-600">C√¢u ti·∫øp theo</button>
        </div>

        <!-- M√†n h√¨nh k·∫øt qu·∫£ -->
        <div id="results-screen" class="hidden text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Ho√†n th√†nh!</h2>
            <p id="final-score-text" class="text-xl text-gray-600 mb-2">B√© ƒë√£ ƒë·∫°t ƒë∆∞·ª£c</p>
            <p id="final-score" class="text-6xl font-bold text-blue-600 mb-6">0/0</p>
            <p id="final-message" class="text-lg text-gray-500 mb-8">C·ªë g·∫Øng l√™n ·ªü l·∫ßn sau nh√©!</p>
            <button id="play-again-btn" class="w-full bg-green-500 text-white font-bold py-4 rounded-lg text-xl hover:bg-green-600">Ch∆°i l·∫°i</button>
        </div>
    </div>

    <script>
        // --- NG√ÇN H√ÄNG C√ÇU H·ªéI L·ªöN ---
        const questions = {
            toan: {
                lop1: [
                    { question: "5 + 4 = ?", options: [8, 9, 10, 7], answer: 9 },
                    { question: "10 - 6 = ?", options: [3, 4, 5, 6], answer: 4 },
                    { question: "S·ªë li·ªÅn sau c·ªßa 19 l√†?", options: [18, 20, 21, 10], answer: 20 },
                    { question: "8 + ... = 12?", options: [3, 4, 5, 6], answer: 4 },
                    { question: "C√≥ bao nhi√™u h√¨nh tam gi√°c: üî∫ üîµ üî∫ üî∫", options: [1, 2, 3, 4], answer: 3 },
                    { question: "9 + 5 = ?", options: [13, 14, 15, 16], answer: 14 },
                    { question: "17 - 8 = ?", options: [7, 8, 9, 10], answer: 9 },
                    { question: "S·ªë b√© nh·∫•t c√≥ hai ch·ªØ s·ªë l√†?", options: [9, 10, 11, 99], answer: 10 },
                    { question: "S·ªë li·ªÅn tr∆∞·ªõc c·ªßa 30 l√†?", options: [28, 29, 31, 32], answer: 29 },
                    { question: "Lan c√≥ 7 k·∫πo, m·∫π cho th√™m 5. Lan c√≥ t·∫•t c·∫£...c√°i k·∫πo?", options: [11, 12, 13, 2], answer: 12 },
                    { question: "10 + 40 = ?", options: [40, 50, 60, 70], answer: 50 },
                    { question: "H√¨nh vu√¥ng c√≥ m·∫•y c·∫°nh b·∫±ng nhau?", options: ["2", "3", "4", "0"], answer: "4" },
                    { question: "ƒêi·ªÅn d·∫•u: 18 ... 10 + 8", options: ["<", ">", "="], answer: "=" },
                    { question: "Tr√™n s√¢n c√≥ 15 con v·ªãt, 6 con xu·ªëng ao. Tr√™n s√¢n c√≤n...con v·ªãt?", options: [21, 8, 9, 10], answer: 9 },
                    { question: "S·ªë g·ªìm 3 ch·ª•c v√† 2 ƒë∆°n v·ªã l√†?", options: [30, 2, 32, 23], answer: 32 },
                    { question: "S·ªë l·ªõn nh·∫•t trong c√°c s·ªë: 15, 25, 5, 21 l√†?", options: [15, 25, 5, 21], answer: 25 },
                    { question: "H√¥m nay l√† th·ª© Ba, ng√†y mai l√† th·ª© m·∫•y?", options: ["Th·ª© Hai", "Th·ª© T∆∞", "Th·ª© NƒÉm"], answer: "Th·ª© T∆∞" },
                    { question: "11 + 8 = ?", options: [18, 19, 20, 21], answer: 19 },
                    { question: "14 - 7 = ?", options: [6, 7, 8, 9], answer: 7 },
                    { question: "20, 30, 40, ..., 60. S·ªë c·∫ßn ƒëi·ªÅn l√†?", options: [45, 50, 55, 41], answer: 50 }
                ],
                lop2: [
                    { question: "3 x 7 = ?", options: [20, 21, 24, 27], answer: 21 },
                    { question: "35 : 5 = ?", options: [6, 7, 8, 9], answer: 7 },
                    { question: "56 + 28 = ?", options: [74, 84, 94, 78], answer: 84 },
                    { question: "81 - 34 = ?", options: [47, 57, 53, 43], answer: 47 },
                    { question: "M·ªôt gi·ªù c√≥ bao nhi√™u ph√∫t?", options: [30, 60, 90, 100], answer: 60 },
                    { question: "4 x 9 = ?", options: [32, 35, 36, 40], answer: 36 },
                    { question: "28 : 4 = ?", options: [6, 7, 8, 9], answer: 7 },
                    { question: "87 + 13 = ?", options: [90, 99, 100, 110], answer: 100 },
                    { question: "100 - 62 = ?", options: [38, 48, 42, 32], answer: 38 },
                    { question: "T√¨m x, bi·∫øt x - 25 = 40", options: [15, 65, 55, 75], answer: 65 },
                    { question: "M·ªói b√†n c√≥ 2 h·ªçc sinh. 9 b√†n nh∆∞ v·∫≠y c√≥...h·ªçc sinh?", options: [11, 16, 18, 20], answer: 18 },
                    { question: "C√°i th∆∞·ªõc d√†i 30cm. ƒê·ªïi 30cm = ...dm?", options: [3, 30, 300, 0.3], answer: 3 },
                    { question: "T√¨m y, bi·∫øt y x 5 = 45", options: [7, 8, 9, 10], answer: 9 },
                    { question: "C√≥ 30 qu·∫£ t√°o chia ƒë·ªÅu cho 5 ƒëƒ©a. M·ªói ƒëƒ©a c√≥...qu·∫£ t√°o?", options: [5, 6, 7, 8], answer: 6 },
                    { question: "S·ªë l·ªõn nh·∫•t c√≥ ba ch·ªØ s·ªë l√†?", options: [100, 987, 999, 990], answer: 999 },
                    { question: "ƒê·ªìng h·ªì ch·ªâ 9 gi·ªù ƒë√∫ng, kim d√†i ch·ªâ s·ªë m·∫•y?", options: [9, 3, 6, 12], answer: 12 },
                    { question: "S·ªë g·ªìm 5 trƒÉm, 0 ch·ª•c, 8 ƒë∆°n v·ªã l√†?", options: [508, 580, 805, 850], answer: 508 },
                    { question: "1km b·∫±ng bao nhi√™u m√©t?", options: [10, 100, 1000, 10000], answer: 1000 },
                    { question: "T√¨m hi·ªáu c·ªßa 72 v√† 19", options: [53, 63, 91, 51], answer: 53 },
                    { question: "C√≥ 5 t√∫i k·∫πo, m·ªói t√∫i 8 c√°i. T·ªïng c·ªông c√≥...c√°i k·∫πo?", options: [13, 35, 40, 45], answer: 40 }
                ]
            },
            tiengviet: {
                lop1: [
                    { question: "T√¨m t·ª´ c√≥ v·∫ßn 'at'", options: ["nh√†", "b√†i h√°t", "s√°ch", "v·ªü"], answer: "b√†i h√°t" },
                    { question: "Trong t·ª´ 'quy·ªÉn s√°ch', ti·∫øng n√†o c√≥ thanh s·∫Øc?", options: ["quy·ªÉn", "s√°ch", "c·∫£ hai", "kh√¥ng c√≥"], answer: "s√°ch" },
                    { question: "ƒêi·ªÅn 'ch' ho·∫∑c 'tr': c√¢y ...e", options: ["ch", "tr"], answer: "tr" },
                    { question: "S·∫Øp x·∫øp th√†nh c√¢u: b√†, em, y√™u", options: ["Em y√™u b√†", "B√† y√™u em", "Y√™u b√† em"], answer: "Em y√™u b√†" },
                    { question: "ƒê√¢u l√† t√™n m·ªôt lo·∫°i qu·∫£?", options: ["b√†n", "gh·∫ø", "xo√†i", "s√¥ng"], answer: "xo√†i" },
                    { question: "ƒêi·ªÅn 'g' hay 'gh': ...√† tr·ªëng", options: ["g", "gh"], answer: "g" },
                    { question: "T√¨m t·ª´ c√≥ v·∫ßn '∆∞∆°i'", options: ["t∆∞∆°i c∆∞·ªùi", "chu·ªìn chu·ªìn", "b√∫t", "c√°"], answer: "t∆∞∆°i c∆∞·ªùi" },
                    { question: "ƒêi·ªÅn 's' hay 'x': ...e ƒë·∫°p", options: ["s", "x"], answer: "x" },
                    { question: "S·∫Øp x·∫øp: xanh, b·∫ßu, tr·ªùi", options: ["Xanh b·∫ßu tr·ªùi", "B·∫ßu tr·ªùi xanh", "Tr·ªùi xanh b·∫ßu"], answer: "B·∫ßu tr·ªùi xanh" },
                    { question: "T·ª´ n√†o ch·ªâ ho·∫°t ƒë·ªông?", options: ["c√°i c·∫∑p", "ng√¥i sao", "xinh ƒë·∫πp", "m√∫a h√°t"], answer: "m√∫a h√°t" },
                    { question: "ƒêi·ªÅn v·∫ßn 'i√™n' hay 'i√™ng': ... l·∫∑ng", options: ["i√™n", "i√™ng"], answer: "i√™ng" },
                    { question: "Ti·∫øng 'ph·ªë' c√≥ √¢m ƒë·∫ßu l√† g√¨?", options: ["ph", "√¥", "p", "h"], answer: "ph" },
                    { question: "C√¢u 'Con m√®o tr√®o c√¢y cau.' c√≥ m·∫•y ti·∫øng?", options: [5, 6, 7, 8], answer: 6 },
                    { question: "ƒêi·ªÅn 'ng' hay 'ngh': ...√© con", options: ["ng", "ngh"], answer: "ng" },
                    { question: "T·ª´ n√†o ch·ªâ ƒë·ªì v·∫≠t trong nh√†?", options: ["c√¥ng vi√™n", "c√°i gi∆∞·ªùng", "con ƒë∆∞·ªùng", "c√°nh ƒë·ªìng"], answer: "c√°i gi∆∞·ªùng" },
                    { question: "ƒêi·ªÅn 'c' hay 'k': ...im kh√¢u", options: ["c", "k"], answer: "k" },
                    { question: "C√¢u 'B·ªë l√† tr·ª• c·ªôt c·ªßa gia ƒë√¨nh.' k·∫øt th√∫c b·∫±ng d·∫•u g√¨?", options: [".", "?", "!", ","], answer: "." },
                    { question: "T·ª´ n√†o vi·∫øt ƒë√∫ng ch√≠nh t·∫£?", options: ["qu·∫£ chanh", "q·ªßa chanh", "qu·∫£ tranh"], answer: "qu·∫£ chanh" },
                    { question: "T√¨m t·ª´ c√≥ v·∫ßn 'oan'", options: ["c√°i b·∫£ng", "to√°n", "lan", "s√°ch"], answer: "to√°n" },
                    { question: "ƒêi·ªÅn 'd', 'gi' hay 'r': ...a ƒë√¨nh", options: ["d", "gi", "r"], answer: "gi" }
                ],
                lop2: [
                    { question: "T·ª´ n√†o kh√¥ng c√πng nh√≥m: b√∫t, th∆∞·ªõc, s√°ch, hoa", options: ["b√∫t", "th∆∞·ªõc", "s√°ch", "hoa"], answer: "hoa" },
                    { question: "C√¢u 'Ai th·∫ø n√†o?':", options: ["Em ƒëang h·ªçc b√†i.", "B√¥ng hoa n√†y r·∫•t ƒë·∫πp.", "B·ªë em l√† b√°c sƒ©."], answer: "B√¥ng hoa n√†y r·∫•t ƒë·∫πp." },
                    { question: "T√¨m t·ª´ tr√°i nghƒ©a v·ªõi 'nhanh'", options: ["v·ªôi", "g·∫•p", "ch·∫≠m", "mau"], answer: "ch·∫≠m" },
                    { question: "D·∫•u c√¢u n√†o d√πng ƒë·ªÉ k·∫øt th√∫c m·ªôt c√¢u h·ªèi?", options: [".", "?", "!", ","], answer: "?" },
                    { question: "T·ª´ n√†o vi·∫øt ƒë√∫ng ch√≠nh t·∫£?", options: ["ngon ngh·∫ªo", "ngo·∫±n ngo√®o", "ngon ngoeo"], answer: "ngo·∫±n ngo√®o" },
                    { question: "T·ª´ n√†o ch·ªâ ƒë·∫∑c ƒëi·ªÉm?", options: ["b∆°i", "t√≠m", "ng·ªß", "c√°i nh√†"], answer: "t√≠m" },
                    { question: "ƒê·∫∑t c√¢u h·ªèi cho b·ªô ph·∫≠n g·∫°ch ch√¢n: '**B√°c n√¥ng d√¢n** ƒëang c√†y ru·ªông.'", options: ["Ai l√†m g√¨?", "L√†m g√¨?", "Ai l√† g√¨?"], answer: "Ai l√†m g√¨?" },
                    { question: "T·ª´ n√†o vi·∫øt sai ch√≠nh t·∫£?", options: ["s·∫£n xu·∫•t", "xu·∫•t s·∫Øc", "d·∫£n d·ªã", "d·ªãu d√†ng"], answer: "d·∫£n d·ªã" },
                    { question: "T·ª´ tr√°i nghƒ©a v·ªõi 'kh·ªèe m·∫°nh' l√†?", options: ["c∆∞·ªùng tr√°ng", "d≈©ng c·∫£m", "y·∫øu ·ªõt", "to l·ªõn"], answer: "y·∫øu ·ªõt" },
                    { question: "C√¢u 'Nh·ªØng ch√∫ chim ƒëang h√≥t tr√™n c√†nh.' thu·ªôc m·∫´u c√¢u n√†o?", options: ["Ai l√† g√¨?", "Ai l√†m g√¨?", "Ai th·∫ø n√†o?"], answer: "Ai l√†m g√¨?" },
                    { question: "Trong c√¢u 'M·∫∑t bi·ªÉn ph·∫≥ng l·∫∑ng v√† r·ªông m√™nh m√¥ng.', t·ª´ ch·ªâ ƒë·∫∑c ƒëi·ªÉm l√†?", options: ["M·∫∑t bi·ªÉn", "ph·∫≥ng l·∫∑ng, r·ªông m√™nh m√¥ng", "v√†"], answer: "ph·∫≥ng l·∫∑ng, r·ªông m√™nh m√¥ng" },
                    { question: "D√≤ng n√†o g·ªìm c√°c t·ª´ ch·ªâ s·ª± v·∫≠t?", options: ["ƒë·∫πp, x·∫•u, t·ªët", "th·∫ßy gi√°o, c√¢y c·ªëi, d√≤ng s√¥ng", "ƒëi, ƒë·ª©ng, n·∫±m"], answer: "th·∫ßy gi√°o, c√¢y c·ªëi, d√≤ng s√¥ng" },
                    { question: "T√¨m t·ª´ ƒë·ªìng nghƒ©a v·ªõi 'to l·ªõn'", options: ["nh·ªè b√©", "ch·∫≠t h·∫πp", "kh·ªïng l·ªì", "th·∫•p"], answer: "kh·ªïng l·ªì" },
                    { question: "B·ªô ph·∫≠n tr·∫£ l·ªùi c√¢u h·ªèi 'Khi n√†o?' trong c√¢u: '**M√πa h√®**, hoa ph∆∞·ª£ng n·ªü ƒë·ªè r·ª±c.'", options: ["M√πa h√®", "hoa ph∆∞·ª£ng", "n·ªü ƒë·ªè r·ª±c"], answer: "M√πa h√®" },
                    { question: "T·ª´ n√†o vi·∫øt ƒë√∫ng ch√≠nh t·∫£?", options: ["l·∫Øng lo", "n·∫Øng no", "lo l·∫Øng", "no n·∫Øng"], answer: "lo l·∫Øng" },
                    { question: "C√¢u '√îi, b·∫°n gi·ªèi qu√°!' l√† lo·∫°i c√¢u g√¨?", options: ["C√¢u k·ªÉ", "C√¢u h·ªèi", "C√¢u c·∫£m"], answer: "C√¢u c·∫£m" },
                    { question: "T√¨m t·ª´ c√≥ hai ti·∫øng ƒë·ªÅu b·∫Øt ƒë·∫ßu b·∫±ng 'ch'", options: ["chƒÉm ch·ªâ", "trung th·ª±c", "ch·∫Øc ch·∫Øn", "ch√≥ng v√°nh"], answer: "chƒÉm ch·ªâ" },
                    { question: "D·∫•u ph·∫©y trong c√¢u 'Em th√≠ch h·ªçc To√°n, Ti·∫øng Vi·ªát v√† √Çm nh·∫°c.' c√≥ t√°c d·ª•ng g√¨?", options: ["NgƒÉn c√°ch c√°c √Ω", "K·∫øt th√∫c c√¢u", "B·∫Øt ƒë·∫ßu c√¢u"], answer: "NgƒÉn c√°ch c√°c √Ω" },
                    { question: "T·ª´ 'hi·ªÅn l√†nh' l√† t·ª´ ch·ªâ ...", options: ["Ho·∫°t ƒë·ªông", "ƒê·∫∑c ƒëi·ªÉm", "S·ª± v·∫≠t"], answer: "ƒê·∫∑c ƒëi·ªÉm" },
                    { question: "B·ªô ph·∫≠n tr·∫£ l·ªùi c√¢u h·ªèi 'V√¨ sao?' trong c√¢u: 'B·∫°n Nam ƒë∆∞·ª£c c√¥ gi√°o khen **v√¨ b·∫°n ·∫•y h·ªçc gi·ªèi**.'", options: ["B·∫°n Nam", "ƒë∆∞·ª£c c√¥ gi√°o khen", "v√¨ b·∫°n ·∫•y h·ªçc gi·ªèi"], answer: "v√¨ b·∫°n ·∫•y h·ªçc gi·ªèi" }
                ]
            }
        };

        // --- BI·∫æN TR·∫†NG TH√ÅI ---
        let selectedSubject = null;
        let selectedGrade = null;
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        const NUM_OF_QUESTIONS_PER_GAME = 12; // S·ªë c√¢u h·ªèi m·ªói l·∫ßn ch∆°i

        // --- L·∫§Y C√ÅC PH·∫¶N T·ª¨ DOM ---
        const selectionScreen = document.getElementById('selection-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultsScreen = document.getElementById('results-screen');
        const startBtn = document.getElementById('start-btn');
        const subjectBtns = document.querySelectorAll('[data-subject]');
        const gradeBtns = document.querySelectorAll('[data-grade]');

        // --- C√ÅC H√ÄM X·ª¨ L√ù ---

        function updateStartButtonState() {
            if (selectedSubject && selectedGrade) {
                startBtn.disabled = false;
                startBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                startBtn.classList.add('bg-blue-600', 'hover:bg-blue-700', 'cursor-pointer');
            } else {
                startBtn.disabled = true;
                startBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                startBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700', 'cursor-pointer');
            }
        }

        function startGame() {
            let allQuestions = questions[selectedSubject][selectedGrade];
            // X√°o tr·ªôn to√†n b·ªô c√¢u h·ªèi v√† l·∫•y ra s·ªë l∆∞·ª£ng c·∫ßn thi·∫øt
            currentQuestions = allQuestions.sort(() => 0.5 - Math.random()).slice(0, NUM_OF_QUESTIONS_PER_GAME);
            
            currentQuestionIndex = 0;
            score = 0;

            selectionScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            resultsScreen.classList.add('hidden');
            
            displayQuestion();
        }

        function displayQuestion() {
            document.getElementById('feedback-container').innerHTML = '';
            document.getElementById('next-btn').classList.add('hidden');

            const questionData = currentQuestions[currentQuestionIndex];
            document.getElementById('question-container').querySelector('p').textContent = questionData.question;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            const shuffledOptions = [...questionData.options].sort(() => Math.random() - 0.5);

            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('answer-option', 'w-full', 'p-4', 'border-2', 'border-gray-300', 'rounded-lg', 'font-semibold', 'text-gray-700');
                button.onclick = (e) => checkAnswer(e.target, questionData.answer);
                optionsContainer.appendChild(button);
            });

            document.getElementById('progress-text').textContent = `C√¢u ${currentQuestionIndex + 1}/${currentQuestions.length}`;
            document.getElementById('score-text').textContent = `ƒêi·ªÉm: ${score}`;
        }

        function checkAnswer(selectedButton, correctAnswer) {
            const allOptions = document.querySelectorAll('.answer-option');
            allOptions.forEach(btn => btn.disabled = true);

            const feedbackContainer = document.getElementById('feedback-container');
            if (selectedButton.textContent == correctAnswer) {
                score++;
                selectedButton.classList.add('correct');
                feedbackContainer.textContent = 'üéâ ƒê√∫ng r·ªìi!';
                feedbackContainer.classList.add('text-green-500');
                feedbackContainer.classList.remove('text-red-500');
            } else {
                selectedButton.classList.add('incorrect');
                feedbackContainer.textContent = 'üò• Sai r·ªìi!';
                feedbackContainer.classList.add('text-red-500');
                feedbackContainer.classList.remove('text-green-500');
                allOptions.forEach(btn => {
                    if (btn.textContent == correctAnswer) {
                        btn.classList.add('correct');
                    }
                });
            }
            document.getElementById('score-text').textContent = `ƒêi·ªÉm: ${score}`;
            document.getElementById('next-btn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuestions.length) {
                displayQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            gameScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            
            const finalScoreText = document.getElementById('final-score');
            finalScoreText.textContent = `${score}/${currentQuestions.length}`;

            const finalMessage = document.getElementById('final-message');
            const percentage = (score / currentQuestions.length) * 100;
            if (percentage === 100) {
                finalMessage.textContent = "Xu·∫•t s·∫Øc! B√© th·∫≠t l√† gi·ªèi!";
            } else if (percentage >= 70) {
                finalMessage.textContent = "Gi·ªèi l·∫Øm! C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©!";
            } else if (percentage >= 50) {
                finalMessage.textContent = "L√†m t·ªët l·∫Øm! Ti·∫øp t·ª•c luy·ªán t·∫≠p nh√©!";
            } else {
                finalMessage.textContent = "ƒê·ª´ng bu·ªìn, l·∫ßn sau s·∫Ω t·ªët h∆°n!";
            }
        }

        function resetGame() {
            resultsScreen.classList.add('hidden');
            selectionScreen.classList.remove('hidden');

            selectedSubject = null;
            selectedGrade = null;

            subjectBtns.forEach(btn => btn.classList.remove('selected'));
            gradeBtns.forEach(btn => btn.classList.remove('selected'));
            updateStartButtonState();
        }

        // --- G·∫ÆN S·ª∞ KI·ªÜN ---
        subjectBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                selectedSubject = btn.dataset.subject;
                subjectBtns.forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                updateStartButtonState();
            });
        });

        gradeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                selectedGrade = btn.dataset.grade;
                gradeBtns.forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                updateStartButtonState();
            });
        });

        startBtn.addEventListener('click', () => {
            if (!startBtn.disabled) {
                startGame();
            }
        });
        
        document.getElementById('next-btn').addEventListener('click', nextQuestion);
        document.getElementById('play-again-btn').addEventListener('click', resetGame);

    </script>
</body>
</html>